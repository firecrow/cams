some small refactoring around tree