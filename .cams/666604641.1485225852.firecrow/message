getting subp to work, mostly, still having a hard time detecting the end of ouput