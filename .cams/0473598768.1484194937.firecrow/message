refactor and migration for new commit id structure