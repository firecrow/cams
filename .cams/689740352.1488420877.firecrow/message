refactoring line emitter into sync.c and utils.c