moving commit related code into its own file