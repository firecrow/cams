#!/usr/bin/env python
import os, sys
from subprocess import Popen, PIPE

camscwd = os.getcwd()
stg_path = camscwd + '/testing/stage'
fixture_path = camscwd + '/testing/fixtures/'

# handle working directory
def cmd(*args, **kwargs):
  cwd= kwargs["cwd"] if kwargs.get("cwd") else stg_path  
  shell= kwargs["shell"] if kwargs.get("shell") else False  
  p = Popen(args, stderr=PIPE, stdout=PIPE, cwd=cwd, shell=shell)
  p.wait()
  return p

print "[clean]"
assert cmd("rm", "-Rf", "testing/stage", cwd=camscwd).returncode == 0, "rm existing"
assert cmd("mkdir", "testing/stage", cwd=camscwd).returncode == 0, "make new stage dir"

print "[init]"
assert cmd("../../cams", "init").returncode == 0, "init"
assert cmd("cp", "1/x", "../stage", cwd=fixture_path).returncode == 0, "set up fixture files"
assert cmd("../../cams", "add", "x").returncode == 0, "add first file"

print "[diff the files in the commit]"
assert cmd("diff", ".cams/1/files/x", "x").returncode == 0, "there should be no diff between the file and the added file"

#
#../../cams commit "adding test file x"
#echo $?
#
#../../cams list
#echo $?
#
#echo "first commit"
#cp -v ../fixtures/1/* . 
#../../cams add x 
#../../cams add y 
#echo $?
#
#../../cams commit "updating x adding y"
#echo $?
#
#../../cams list
#echo $?

# test diff
# test commit messages
# test index

# all user facing commands
# x init
# - add
# - reset
# - commit
# - list
# - push
# - checkout
# - show
# - reindex
# - index
# - cindex
# - diff
