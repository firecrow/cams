refactoring how status is gathered so it can be used by diff