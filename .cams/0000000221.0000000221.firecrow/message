broken, working on memory leaks in commit