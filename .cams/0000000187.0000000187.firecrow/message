some working stuff for the new commit flow, still broken tests